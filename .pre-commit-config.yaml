# See https://pre-commit.com for more information
# See https://pre-commit.com/hooks.html for more hooks
repos:
-   repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
    -   id: trailing-whitespace
    -   id: end-of-file-fixer
    -   id: mixed-line-ending
        args: [--fix=lf]

-   repo: local
    hooks:
    -   id: lint
        name: Lint Python files
        entry: uv run ruff check
        language: python
        types: [file, python]
        exclude: ^(tests/|scripts/).*$

    -   id: type-check
        name: Type check Python files
        entry: uv run mypy
        language: python
        types: [file, python]
        exclude: ^(tests/|scripts/).*$

    -   id: aws-credential-check
        name: Check for AWS credentials
        entry: git secrets --scan
        language: system
        types: [text]

    -   id: terraform-fmt
        name: Format Terraform files
        entry: terraform fmt -recursive
        language: system
        types: [file]
        files: \.tf$
        args: [-write=true]

    -   id: terraform-validate-production
        name: Validate Terraform production environment
        entry: bash -c "cd terraform/environments/production && terraform validate"
        language: system
        types: [file]
        files: ^terraform/environments/production/.*\.tf$
        pass_filenames: false

    -   id: unit-test
        name: Run unit tests
        entry: uv run pytest --cov src --cov-branch --cov-report term-missing --cov-report xml --cov-report html
        language: python
        types: [file, python]
        stages: [pre-merge-commit]
        pass_filenames: false

default_install_hook_types: [pre-commit, pre-merge-commit]
